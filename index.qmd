---
title: "Unraveling Tornado Trends"
subtitle: "INFO 526 - Project 1"
author: "Aes-thetics-Squad"
format: html
editor: visual
---

## Abstract

This data visualization project centers on unraveling patterns in tornado occurrences and their impacts across the United States. Tornadoes are violent, rotating columns of air that form severe thunderstorms capable of producing destructive winds. In this project we delve into two critical aspects: tornado magnitude patterns and the tornado related fatalities in each state . Through innovative visualizations like alley maps and horizontal bar plot, we seek to provide a clearer understanding of tornado phenomena, enabling informed decision-making and proactive disaster management.

## Introduction

This tornadoes data comes from NOAA's National Weather Service Storm Prediction CenterÂ [Severe Weather Maps, Graphics, and Data Page](https://www.spc.noaa.gov/wcm/#data). It is also available on the tidytuesday github page. The data has 68,693 rows and 27 columns, including numerical and categorical variables. It equips us with a treasure trove of information spanning over seven decades that is from 1950 to 2022.

To gain a deeper understanding of these tornadoes, we delve into this data containing variables such as 'magnitude'- the magnitude of tornadoes , 'state' -the state in which the tornado occurred, 'fatalities'-number of deaths for each tornado, 'year'- the year in which the tornado occurred, 'slat'- starting latitude, 'slon'-starting longitude, 'elat'- ending latitude, 'elon' - ending longtitude.

## Question 1: Are there any patterns in the magnitude of tornadoes based on location or time of year?

### Introduction

Understanding the variations in tornado intensity is vital for assessing their potential impact and devising effective disaster response plans. In this section, we explore the patterns in tornado magnitude concerning geographical location (states) and how they fluctuate across different times of the year. By examining these patterns, we aim to uncover insights that can aid in predicting and preparing for tornadoes of varying intensities, contributing to enhanced public safety and disaster management.

### Approach

Understanding the dynamics of tornado magnitude and its geographical distribution is paramount in assessing the severity of these natural disasters. In our analysis, we focus on crucial variables such as tornado magnitude, states, and years. By delving into these parameters, we aim to uncover patterns in tornado intensity across various states and seasons. To visualize these patterns effectively, we employ geospatial visualization techniques, plotting the tornado magnitudes on a US map. Specifically, we select five states with notable variations in tornado magnitude and plot tornado intensity for each of these states over time, highlighting the longitudinal trends and potential correlations.

For our initial visualization, we generate density plots for tornadoes in the selected states (Texas, Florida, Oklahoma, Kansas, and Nebraska) over distinct periods (1950-1961, 1962-1973, 1974-1985, 1986-1997, 1998-2009, 2010-2022). This allows us to observe how tornado intensity patterns have evolved over these years. Additionally, we present an animated plot, integrating the individual density plots, to offer a dynamic view of the tornado magnitude trends, providing a visually engaging perspective of the changes.

Further exploring the data, we analyze tornado trends in terms of mean magnitude and count per year (1950-2022). The line plot showcasing mean magnitude per year provides insights into the average intensity of tornadoes, aiding in understanding long-term trends. Concurrently, the plot depicting the count of tornadoes per year helps in comprehending the frequency of tornado occurrences over the specified period. This multifaceted analysis aims to provide a comprehensive view of tornado magnitude variations, facilitating informed decisions and strategies for disaster preparedness and response.

Lastly, we delve into a categorical analysis of tornado intensity based on the Enhanced Fujita (EF) scale, categorized by year periods. The stacked bar plot allows us to observe the proportion of tornadoes in each magnitude category for different year periods, aiding in identifying trends in tornado intensity over time. This analytical approach aims to derive valuable insights into tornado behaviors and their potential implications for disaster preparedness and response strategies, ultimately contributing to minimizing the impact of tornado events.

### Analysis

```{r Q1code, message=FALSE, warning=FALSE, echo=FALSE}
if(!require(pacman))
  install.packages("pacman")

pacman::p_load(tidyverse,
               kableExtra,
               ggplot2,
               dplyr,
               sf,
               maps,
               scales,
               tidyr,
               MASS,
               patchwork,
               animation,
               png
)

tornados <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-05-16/tornados.csv', show_col_types = FALSE)
tornados <- tornados[complete.cases(tornados),]
tornados <- tornados |>
  mutate(
  year_category=case_when(
(yr>=1950 & yr<=1961) ~ "1950-1961",
(yr>=1962 & yr<=1973) ~ "1962-1973",
(yr>=1974 & yr<=1985) ~ "1974-1985",
(yr>=1986 & yr<=1997) ~ "1986-1997",
(yr>=1998 & yr<=2009) ~ "1998-2009",
(yr>=2010 & yr<=2022) ~ "2010-2022"
)
)


tornado_sf <- st_as_sf(tornados, coords = c("slon", "slat"), crs = 4326)

# Group the data by state and using standard deviation to calculate variations in magnitudes
state_variations <- tornado_sf %>%
  group_by(st) %>%
  summarize(
    magnitude_variation = sd(mag),
    tornado_count = n()
  ) %>%
  ungroup()

# Select the top 5 states with the highest variations
top_5_states <- state_variations %>%
  top_n(5, magnitude_variation)



us_map=map_data("state")
map("state", ".", exact = FALSE, plot = FALSE, fill = TRUE) %>% 
  fortify(map_obj) %>% 
  as_tibble() -> state_map

xlim <- range(state_map$long)
ylim <- range(state_map$lat)



generate_density_plot <- function(year_range, plot_title) {
  req_tor <- tornados[tornados$st %in% top_5_states$st & tornados$yr %in% year_range, ]
  density_data <- kde2d(req_tor$slon, req_tor$slat, n = 100)
  density_df <- as.data.frame(expand.grid(x = density_data$x, y = density_data$y))
  density_df$density <- c(density_data$z)
 
ggplot() +
    geom_contour(data=density_df, aes(x = x, y = y, z = density, color = after_stat(level)), bins = 25) +
    scale_color_gradient(low = "blue", high = "red1", limits = c(0.005, 0.020), oob = scales::squish) +
    labs(title = plot_title) +
    geom_polygon(data = us_map, aes(x = long, y = lat, group = group), color = "black", fill = NA) +
    borders("state", colour = "black") +
    theme_minimal() +
    theme(plot.title = element_text(size = 16)) +
    coord_cartesian(ylim = ylim)  # Keep the same y-axis limits for all plots
}

years <- list(
  seq(1950, 1961),
  seq(1962, 1973),
  seq(1974, 1985),
  seq(1986, 1997),
  seq(1998, 2009),
  seq(2010, 2022)
)

save_plot_as_image <- function(plot, filename) {
  ggsave(plot, filename = paste0("images/", filename), width = 6, 
         height = 6, units = "in", bg = "white")
}

plot_titles <- c("1950-1961", "1962-1973", "1974-1985", "1986-1997", "1998-2009", "2010-2022")
filenames <-c("plot1.png","plot2.png","plot3.png","plot4.png","plot5.png","plot6.png")

plots <- list()

for (i in seq_along(years)) {
  plots[[i]] <- generate_density_plot(years[[i]], plot_titles[i])
  save_plot_as_image(plots[[i]], filenames[i])
}




plots[[1]] + plots[[2]] + plot_layout(guides = "collect")
plots[[3]] +plots[[4]] + plot_layout(guides = "collect")
plots[[5]] + plots[[6]] + plot_layout(guides = "collect")




image_paths <- list.files("images", full.names = TRUE)

# Create an animated GIF
ani.options(ani.width = 1000, ani.height = 1000, res = 1020, "animated_plot.gif")

saveGIF({
  for (img_path in image_paths) {
    img <- readPNG(img_path)
    plot(0, 0, type = "n", xlim = c(0, 1), ylim = c(0, 1), 
         xlab = "", ylab = "", main = "Tornado Magnitude Trends", cex.main = 3)
    rasterImage(img, 0, 0, 1, 1)
  }
}, interval = 1, movie.name = "animated_plot.gif")


annual_mean <- tornados %>%
  group_by(yr) %>%
  summarise(mean_mag = mean(mag, na.rm = TRUE), count = n(), .groups = "drop")
mag_plot <- ggplot(data = annual_mean) +
  geom_line(aes(x = yr, y = mean_mag),linewidth = 1,col="#00A572") +
  labs(
    x = "Year",
    y = "Mean Magnitude per year",
    title = "Tornado Magnitude Trends Over Time (1950-2022)"
  ) +
  theme_minimal()

num_plot<-ggplot(data = annual_mean) +
  geom_line(aes(x = yr, y = count), linewidth = 1, col="#FF69B4") +
  geom_smooth(aes(x = yr, y = count), method = lm,se=FALSE, col="#1E90FF") +
  labs(
    x = "Year",
    y = "Number of Tornadoes per year",
    title = "Tornadoes count Over Time (1950-2022)"
  ) +
  theme_minimal()
mag_plot
num_plot

t<-tornados|>
  group_by(year_category)|>
  summarize(num = n(), .groups = "drop")

tor_req<-tornados |>
  group_by(mag, year_category) |>
  summarize(num = n(),.groups = "drop") |>
  mutate(mag = factor(mag, levels = c(0,1,2,3,4,5))) |>
  ungroup()

ggplot(data = tor_req,
       mapping = aes(fill = mag, y = num, x = year_category))+
  geom_bar(
    position = "fill",
    stat = "identity"
  ) +
  scale_fill_manual(values = c("skyblue1", "#FFA533", "#FF5733", "#33FF57", "yellow", "black")) +
  scale_y_continuous(labels = scales::percent) +
  coord_flip()
```

### Discussion

The analysis of tornado magnitude variations across different states presents compelling insights into the dynamics of tornado intensity. By utilizing the Enhanced Fujita (EF) scale, we were able to categorize tornadoes based on their severity. The geospatial visualization showcased distinct patterns of tornado magnitudes in the selected states - Texas, Florida, Oklahoma, Kansas, and Nebraska. Notably, Texas exhibited consistent high magnitudes, signifying its vulnerability to severe tornadoes. Understanding such geographical variations in tornado intensity is crucial for disaster preparedness and response strategies in these regions.

Additionally, exploring tornado magnitude trends over time (1950-2022) shed light on the evolving nature of tornadoes. The line plot illustrating mean magnitude per year revealed fluctuations in tornado intensity, emphasizing the necessity for continuous monitoring and research to comprehend the underlying factors influencing these variations. Concurrently, the analysis of the count of tornadoes per year provided valuable insights into the frequency of tornado occurrences. The smooth trend line overlaying the count plot accentuated the potential correlation between tornado frequency and climatic or environmental changes over the years.

Furthermore, examining tornado magnitudes in different categories (EF scale) across distinct year categories (1950-1961, 1962-1973, 1974-1985, 1986-1997, 1998-2009, 2010-2022) through a stacked bar plot illuminated the distribution of tornado intensities over time. The plot revealed fluctuations in the proportion of tornadoes in each magnitude category, reflecting the changing patterns of tornado intensity across the specified year categories. Understanding these trends is instrumental in devising strategies to mitigate the impact of tornadoes and enhance disaster resilience in the affected regions.

In conclusion, this comprehensive analysis of tornado magnitude trends offers valuable insights into the spatiotemporal dynamics of tornado intensity. By dissecting the data from multiple perspectives, we gain a deeper understanding of tornado behaviors, providing a strong foundation for informed decision-making in disaster management and risk reduction strategies.

## Question 2: Analyzing the trends in fatalities in different state

### Introduction

Tornadoes, besides causing property damage, often result in injuries and fatalities, making an analysis of their impact crucial. In this section, we focus on understanding the trends in fatalities caused by tornadoes across various states in the United States. To address this query, it is essential to focus on specific components of the dataset, such as the year, state, and fatality counts.

Firstly, understanding how fatality rates have changed over time provides crucial insights into the effectiveness of disaster preparedness and response efforts. It helps in evaluating the impact of various safety measures and policies implemented over the years. Additionally, as climate patterns continue to shift, studying these trends can offer valuable information for adapting strategies to mitigate the human toll of tornadoes in the future. Ultimately, this analysis holds the potential to save lives and enhance the resilience of communities in the face of these natural disasters.

### Approach

To address the question regarding trends in tornado-related fatalities, we employed an area plot and a bar plot. Firstly, we utilized a area plot to visualize the general trend in the total number of fatalities over the years from 1950 to 2022. An area chart provides an effective representation of cumulative or aggregated data over a continuous range, making it ideal for showcasing trends and variations in a data over time. It allows us to observe the cumulative total of fatalities increasing over the years. Each point on the chart represents the cumulative sum of fatalities up to a specific year, providing a clear visual indication of how the fatality count has evolved.

From the area chart we saw that there are 2 peaks in the years 1953 and 2011. So, we employed a bar plot to investigate the total fatalities for those years in each state. The horizontal bar chart excels at facilitating comparisons between different categories, which in this case, are the individual states. Each bar on the chart corresponds to a specific state. The length of each bar directly corresponds to the number of fatalities, longer bars signify higher fatality counts, allowing viewers to readily grasp the relative impact of tornado-related incidents across different states

### Analysis

```{r Q2code, warning=FALSE, message=FALSE, echo=FALSE}
if(!require(pacman))
  install.packages("pacman")

pacman::p_load(ggplot2,dplyr)

#suppress warning

knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

```{r loading_data2, warning=FALSE, echo=FALSE, message=FALSE}
tornadoes <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-05-16/tornados.csv', show_col_types = FALSE)
tornadoes <- na.omit(tornadoes)
```

```{r datawranglingQ2, message=FALSE, warning=FALSE, echo=FALSE}
#creating new column called state name
state_mapping <- setNames(state.name, state.abb)

# Add a new column "state_name" to the tornadoes dataset
tornadoes$state_name <- state_mapping[tornadoes$st]
```

```{r Q2plot1, message=FALSE, warning=FALSE, echo=FALSE}
total_fatalities <- aggregate(fat ~ yr, data = tornadoes, sum)

# creating an area plot
ggplot(total_fatalities, aes(x = yr, y = fat)) +
  geom_area(fill="#8B0000")+
  geom_line(color="#8B0000") +
  labs(title = "Total Fatalities Over the Years",
       x = "Year",
       y = "Total Fatalities") +
  scale_x_continuous(
    breaks = seq(1950, 2022, by = 10),
    limits = c(1950, 2022))+
  theme_minimal()+
  annotate("text",x=1955,y=500, label= "1953", color = '#8B0000',
           size = 4)+
  annotate("text",x=2014,y=510, label= "2011", color = '#8B0000',
           size = 4)
```

```{r Q2plot2, message=FALSE, warning=FALSE, echo=FALSE}
total_fatalities <- tornadoes |>
  filter(yr %in% c(1953,2011))|>
  aggregate(fat ~ state_name, sum) |>
  arrange(desc(fat)) |>
  filter(fat>0)

#creaing a bar plot
ggplot(total_fatalities, aes(x = reorder(state_name, fat), y = fat)) +
  geom_bar(stat="identity",fill="#8B0000") +
  geom_text(aes(label=fat), vjust=0.2,hjust=0,size=3) +
  coord_flip()+
  labs(x=NULL,
       y=NULL,
       title = "Total fatalities",
       subtitle="In the years 1953 and 2011",
       caption = "States not listed didnot record any deaths by tornadoes")+
  theme_minimal()+
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    axis.text.x = element_blank()
  )
```

### Discussion

In the given analysis, we observe notable trends in tornado-related fatalities over the years. The area plot depicting total fatalities over the years shows a fluctuating pattern, with peaks and valleys in different periods. There was a peak in the year 1953 resulting in a total of almost 500 deaths in that year. After this they were random peaks and troughs from 1960's to 2010 . There was another noticeable increase in fatalities, with a peak in 2011, it is similar to the peak that occurred in 1953. In recent years, from the mid-2010s, there seems to be a slight uptick in fatalities.

The horizontal bar chart illustrates the total fatalities for select years (1953 and 2011) both years combined across various states. It reveals significant disparities in fatality counts, with some states experiencing much higher casualties than others. For instance, Alabama, Missouri and Texas are the top 3 states that has the highest death counts.

These trends may be influenced by various factors, including local infrastructure, disaster preparedness, and population density. Additionally, meteorological conditions and geographical features could play a role in the frequency and severity of tornado events in different states. Further studies could delve into these potential drivers to provide a more comprehensive understanding of the observed trends.
