{
  "hash": "0259d31d61e1591453c1a2e7408ebd0f",
  "result": {
    "markdown": "---\ntitle: \"Unraveling Tornado Trends\"\nsubtitle: \"INFO 526 - Fall 2023 - Project 1\"\nauthor: \"\"\ntitle-slide-attributes:\n  data-background-image: images/watercolour_sys02_img34_teacup-ocean.jpg\n  data-background-size: stretch\n  data-background-opacity: \"0.7\"\n  data-slide-number: none\nformat:\n  revealjs:\n    theme:  ['data/customtheming.scss']\n  \neditor: visual\nexecute:\n  echo: false\n---\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n# Tornado Dataset Analysis\n\n## **Dataset Description**\n\n-   Data sourced from NOAA's National Weather Service Storm Prediction Center.\n\n-   Key variables include tornado number, year, month, state, magnitude, injuries, fatalities, property loss, length, width, and states affected.\n\n-   Loaded using **`tidytuesdayR`** package or manually read from a CSV file.\n\n## \n\n### Question 1: Are there any patterns in the magnitude of tornadoes based on location or time of year?\n\n## **Plot 1**\n\n::: columns\nThe plot is a line graph that illustrates how the mean magnitude of tornadoes has changed over time from 1950 to 2022.\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](presentation_files/figure-revealjs/unnamed-chunk-5-1.png){width=1650}\n:::\n:::\n\n:::\n:::\n\n## Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Loading the required packages using pacman\nif(!require(pacman))\n  install.packages(\"pacman\")\n\npacman::p_load(tidyverse,\n               kableExtra,\n               ggplot2,\n               dplyr,\n               sf,\n               maps,\n               scales,\n               tidyr,\n               MASS,\n               patchwork,\n               animation,\n               png\n)\n\n#Reading the dataset and adding a new column to the data\ntornados <- readr::read_csv('data/tornados.csv', show_col_types = FALSE)\ntornados <- tornados[complete.cases(tornados),] #Decided to remove the NA values\ntornados <- tornados |>\n  mutate(\n  year_category = case_when(\n(yr >= 1950 & yr <= 1961) ~ \"1950-1961\",\n(yr >= 1962 & yr <= 1973) ~ \"1962-1973\",\n(yr >= 1974 & yr <= 1985) ~ \"1974-1985\",\n(yr >= 1986 & yr <= 1997) ~ \"1986-1997\",\n(yr >= 1998 & yr <= 2009) ~ \"1998-2009\",\n(yr >= 2010 & yr <= 2022) ~ \"2010-2022\"\n)\n)\n\n#Line plot showing magnitude trends\nannual_mean <- tornados %>%\n  group_by(yr) %>%\n  summarise(mean_mag = mean(mag, na.rm = TRUE), count = n(), .groups = \"drop\")\nmag_plot <- ggplot(data = annual_mean) +\n  geom_line(aes(x = yr, y = mean_mag),linewidth = 1,col=\"#00A572\") +\n  labs(\n    x = \"Year\",\n    y = \"Mean Magnitude per year\",\n    title = \"Tornado Magnitude Trends Over Time (1950-2022)\"\n  ) +\n  theme_minimal()\n```\n:::\n\n\n## **Plot 2**\n\n::: columns\nThe plot is a line graph that illustrates how the number of tornadoes has changed over time from 1950 to 2022.\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](presentation_files/figure-revealjs/unnamed-chunk-7-1.png){width=1650}\n:::\n:::\n\n:::\n:::\n\n## Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Line plot showing count of tornado occurences\nnum_plot<-ggplot(data = annual_mean) +\n  geom_line(aes(x = yr, y = count), linewidth = 1, col=\"#FF69B4\") +\n  geom_smooth(aes(x = yr, y = count), method = lm, se=FALSE, col=\"#1E90FF\") +\n  labs(\n    x = \"Year\",\n    y = \"Number of Tornadoes per year\",\n    title = \"Count of Tornado Occurences Over Time (1950-2022)\"\n  ) +\n  theme_minimal()\n```\n:::\n\n\n## **Plot 3**\n\n::: columns\nThe bar plot illustrates the distribution of tornado magnitudes over 12-year intervals, revealing trends in the prevalence of different magnitude categories.\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](presentation_files/figure-revealjs/unnamed-chunk-9-1.png){width=1650}\n:::\n:::\n\n:::\n:::\n\n## Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Bar plot to see the number\ntor_req<-tornados |>\n  group_by(mag, year_category) |>\n  summarize(num = n(),.groups = \"drop\") |>\n  mutate(mag = factor(mag, levels = c(0,1,2,3,4,5))) |>\n  ungroup()\n\nnew_plot <- ggplot(data = tor_req,\n       mapping = aes(fill = mag, y = num, x = year_category))+\n  geom_bar(stat = \"identity\") +\n  scale_fill_manual(values = c(\"skyblue1\", \"#FFA533\", \"#FF5733\", \"#33FF57\", \"yellow\", \"black\"), name = \"Magnitude\") +\n  labs(y = \"Number of occurences\", x = \"Year categories\", \n       title = \"Tornado Magnitude Distribution over the 12 year intervals\") +\n  theme_minimal() +\n  coord_flip()\n```\n:::\n\n\n## **Plot 4**\n\n::: columns\n::: columns\n<div>\n\nAnalyzing tornado data, calculating variations in tornado magnitudes, and creating density contour plots to visualize the variations in the top 5 states for different year ranges.\n\n</div>\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE\n```\n:::\n:::\n\n:::\n:::\n\n## Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Density plots for Tornado occurences\ntornado_sf <- st_as_sf(tornados, coords = c(\"slon\", \"slat\"), crs = 4326)\n\n# Grouping the data by state and using standard deviation to calculate variations in magnitudes\nstate_variations <- tornado_sf %>%\n  group_by(st) %>%\n  summarize(\n    magnitude_variation = sd(mag),\n    tornado_count = n()\n  ) %>%\n  ungroup()\n\n# Selecting the top 5 states with the highest magnitude variations\ntop_5_states <- state_variations %>%\n  top_n(5, magnitude_variation)\n\n\n\nus_map=map_data(\"state\")\nmap(\"state\", \".\", exact = FALSE, plot = FALSE, fill = TRUE) %>% \n  fortify(map_obj) %>% \n  as_tibble() -> state_map\n\nxlim <- range(state_map$long)\nylim <- range(state_map$lat)\n\n\n#Density plot generation\ngenerate_density_plot <- function(year_range, plot_title) {\n  req_tor <- tornados[tornados$st %in% top_5_states$st & tornados$yr %in% year_range, ]\n  density_data <- kde2d(req_tor$slon, req_tor$slat, n = 100)\n  density_df <- as.data.frame(expand.grid(x = density_data$x, y = density_data$y))\n  density_df$density <- c(density_data$z)\n \nggplot() +\n    geom_contour(data=density_df, aes(x = x, y = y, z = density, color = after_stat(level)), bins = 25) +\n    scale_color_gradient(low = \"blue\", high = \"red1\", limits = c(0.005, 0.020), \n                         oob = scales::squish, name = \"Density\") +\n    labs(title = plot_title) +\n    geom_polygon(data = us_map, aes(x = long, y = lat, group = group), color = \"black\", fill = NA) +\n    borders(\"state\", colour = \"black\") +\n    theme_minimal() +\n    theme(plot.title = element_text(size = 16)) +\n    coord_cartesian(ylim = ylim)  # Keep the same y-axis limits for all plots\n}\n\nyears <- list(\n  seq(1950, 1961),\n  seq(1962, 1973),\n  seq(1974, 1985),\n  seq(1986, 1997),\n  seq(1998, 2009),\n  seq(2010, 2022)\n)\n\n#Saving the plots as images\nsave_plot_as_image <- function(plot, filename) {\n  ggsave(plot, filename = paste0(\"images/\", filename), width = 6, \n         height = 6, units = \"in\", bg = \"white\")\n}\n\nplot_titles <- c(\"1950-1961\", \"1962-1973\", \"1974-1985\", \"1986-1997\", \"1998-2009\", \"2010-2022\")\nfilenames <-c(\"plot1.png\",\"plot2.png\",\"plot3.png\",\"plot4.png\",\"plot5.png\",\"plot6.png\")\n\nplots <- list()\n\nfor (i in seq_along(years)) {\n  plots[[i]] <- generate_density_plot(years[[i]], plot_titles[i])\n  save_plot_as_image(plots[[i]], filenames[i])\n}\n\n#For display\n#>plots[[1]] + plots[[2]] + plot_layout(guides = \"collect\")\n#>plots[[3]] +plots[[4]] + plot_layout(guides = \"collect\")\n#>plots[[5]] + plots[[6]] + plot_layout(guides = \"collect\")\n\n\n#To create a gif\nimage_paths <- list.files(\"images\", full.names = TRUE)\nselected_images <- grep(\"^plot[1-6]\\\\.png$\", basename(image_paths), value = TRUE)\nselected_images <- file.path(\"images\",selected_images)\n\n# Creating an animated GIF\nani.options(ani.width = 1000, ani.height = 1000, res = 1020, \"animated_plot.gif\")\n\nsaveGIF({\n  for (img_path in selected_images) {\n    img <- readPNG(img_path)\n    plot(0, 0, type = \"n\", xlim = c(0, 1), ylim = c(0, 1), \n         xlab = \"\", ylab = \"\", main = \"Tornado Occurence Density Trends\", cex.main = 3)\n    rasterImage(img, 0, 0, 1, 1)\n  }\n}, interval = 1, movie.name = \"animated_plot.gif\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE\n```\n:::\n:::\n\n\n## \n\n### Question 2: Analyzing the trends in fatalities in different states\n\n## Plot 1\n\n::: columns\ncreating an area plot to visualize the total fatalities over the years. It highlights significant tornado years like 1953 and 2011 in red.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](presentation_files/figure-revealjs/unnamed-chunk-13-1.png){width=1350}\n:::\n:::\n\n:::\n\n## Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntornadoes <- read_csv('data/tornados.csv')\ntornadoes <- na.omit(tornadoes)\n\n#creating new column called state name\nstate_mapping <- setNames(state.name, state.abb)\n\n# Add a new column \"state_name\" to the tornadoes dataset\ntornadoes$state_name <- state_mapping[tornadoes$st]\n\n#Calculating the total fatalities\ntotal_fatalities <- aggregate(fat ~ yr, data = tornadoes, sum)\n\n# creating an area plot\nplot <- ggplot(total_fatalities, aes(x = yr, y = fat)) +\n  geom_area(fill=\"#8B0000\") +\n  geom_line(color=\"#8B0000\") +\n  labs(title = \"Total Fatalities Over the Years\",\n       x = \"Year\",\n       y = \"Total Fatalities\") +\n  scale_x_continuous(\n    breaks = seq(1950, 2022, by = 10),\n    limits = c(1950, 2022)) +\n  theme_minimal() +\n  annotate(\"text\",x=1955,y=500, label= \"1953\", color = '#8B0000',\n           size = 4) +\n  annotate(\"text\",x=2014,y=510, label= \"2011\", color = '#8B0000',\n           size = 4)\n```\n:::\n\n\n## Plot 2\n\n::: columns\nThis plot illustrates the total fatalities caused by tornadoes in specific years (1953 and 2011) across different U.S. states, providing insights into the geographic distribution of tornado-related deaths during those periods.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](presentation_files/figure-revealjs/unnamed-chunk-15-1.png){width=1350}\n:::\n:::\n\n:::\n\n## Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntotal_fatalities <- tornadoes |>\n  filter(yr %in% c(1953,2011))|>\n  aggregate(fat ~ state_name, sum) |>\n  arrange(desc(fat)) |>\n  filter(fat>0)\n\n#creaing a horizontal bar plot\nplot <- ggplot(total_fatalities, aes(x = reorder(state_name, fat), y = fat)) +\n  geom_bar(stat=\"identity\",fill=\"#8B0000\") +\n  geom_text(aes(label=fat), vjust=0.2,hjust=0,size=3) +\n  coord_flip() +\n  labs(x=NULL,\n       y=NULL,\n       title = \"Total fatalities\",\n       subtitle=\"In the years 1953 and 2011\",\n       caption = \"States not listed didnot record any deaths by tornadoes\")+\n  theme_minimal() +\n  theme(\n    panel.grid.major.x = element_blank(),\n    panel.grid.minor.x = element_blank(),\n    axis.text.x = element_blank()\n  )\n```\n:::\n\n\n# \n",
    "supporting": [
      "presentation_files\\figure-revealjs"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\r\n<script>\r\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\r\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\r\n  // slide changes (different for each slide format).\r\n  (function () {\r\n    // dispatch for htmlwidgets\r\n    function fireSlideEnter() {\r\n      const event = window.document.createEvent(\"Event\");\r\n      event.initEvent(\"slideenter\", true, true);\r\n      window.document.dispatchEvent(event);\r\n    }\r\n\r\n    function fireSlideChanged(previousSlide, currentSlide) {\r\n      fireSlideEnter();\r\n\r\n      // dispatch for shiny\r\n      if (window.jQuery) {\r\n        if (previousSlide) {\r\n          window.jQuery(previousSlide).trigger(\"hidden\");\r\n        }\r\n        if (currentSlide) {\r\n          window.jQuery(currentSlide).trigger(\"shown\");\r\n        }\r\n      }\r\n    }\r\n\r\n    // hookup for slidy\r\n    if (window.w3c_slidy) {\r\n      window.w3c_slidy.add_observer(function (slide_num) {\r\n        // slide_num starts at position 1\r\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\r\n      });\r\n    }\r\n\r\n  })();\r\n</script>\r\n\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}